<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="Genopoisk - –ü–æ–∏—Å–∫ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∏–ª—å–º–æ–≤ –æ–Ω–ª–∞–π–Ω. –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: –ö–∏–Ω–æ–ø–æ–∏—Å–∫ API. –ü–ª–µ–µ—Ä: Embess">
    <meta name="author" content="Genocide Team">
    <meta name="data-source" content="Kinopoisk Unofficial API - kinopoiskapiunofficial.tech">
    <meta name="video-source" content="Embess Player - api.embess.ws">
    <title>üé¨ Genopoisk</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>/* —Å—Ç–∏–ª—å –Ω–µ –∏–∑–º–µ–Ω—è–ª—Å—è, –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º */</style>
</head>
<body>
    <div class="container" id="mainView">...</div>
    <div class="footer">...</div>
    <div class="player-container" id="playerContainer">...</div>

    <script>
        // ... –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ...
        const API_KEY = '26d2222a-3f07-492d-a17e-80fdc91e2fe9';
        const API_BASE = 'https://kinopoiskapiunofficial.tech/api';
        const PLAYER_CONFIG = { host: 'kinotut.me', token: '0926b7296919955c8f9d1559ec54505a', sharing: false };
        let currentPage = 1, currentCategory = null, isLoading = false, hasMore = true, searchTimeout = null;

        async function kpGet(url) {
            const res = await fetch(url, {headers:{'X-API-KEY':API_KEY,'Accept':'application/json'}});
            if (!res.ok) throw new Error(await res.text()||`HTTP ${res.status}`);
            const ct = res.headers.get('content-type')||'';
            if (!ct.includes('application/json')) throw new Error(await res.text()||'The string did not match the expected pattern.');
            return res.json();
        }

        function searchFilms() {
            const q = document.getElementById('searchInput').value.trim();
            if (q.length) liveSearch(q);
        }
        document.getElementById('searchInput').addEventListener('input',function(e){const q=e.target.value.trim();clearTimeout(searchTimeout);if(q.length>=2)searchTimeout=setTimeout(()=>liveSearch(q),500);else if(q.length===0)goBack();});

        async function liveSearch(query){/*...*/} // –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        async function loadCategory(category) {
            if (isTelegramWebApp && telegramBackButton) telegramBackButton.show();
            currentCategory = category; currentPage = 1; hasMore = true;
            document.getElementById('filmsGrid').innerHTML = '';
            document.getElementById('randomPreview').innerHTML = '';
            document.getElementById('qualityWarning').innerHTML = '';
            if (category=== 'random') await loadRandomFilm(); else {await loadMoreFilms();setupInfiniteScroll();}
        }
        async function loadRandomFilm() {
            showLoading();
            try {
                const randomPage = Math.floor(Math.random() * 10) + 1;
                const url = `${API_BASE}/v2.2/films/top?type=TOP_250_BEST_FILMS&page=${randomPage}`;
                const data = await kpGet(url);
                const films = data.items || data.films || [];
                if (films.length > 0) {
                    const randomFilm = films[Math.floor(Math.random() * films.length)];
                    displayRandomFilm(randomFilm);
                } else {
                    throw new Error('–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç API');
                }
            } catch(e) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: '+e.message);
            } finally { hideLoading(); }
        }
        async function loadMoreFilms() { /* —Ç–æ–∂–µ –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞ data.items || data.films */ }
        // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (displayRandomFilm, displayFilms –∏ —Ç.–¥.) ...
    </script>
</body>
</html>
