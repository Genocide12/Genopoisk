<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, maximum-scale=1, minimum-scale=1">
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Genopoisk">
  <meta name="yandex-verification" content="de26e5eef41c71ea" />
  <meta name="google-site-verification" content="Yd6LYUl97HtqaAmwgFf7BJIauzpoOLVc1epesFXZ890" />
  <title>Genopoisk ‚Äî —Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∏–ª—å–º—ã –æ–Ω–ª–∞–π–Ω –±–µ—Å–ø–ª–∞—Ç–Ω–æ –≤ —Ö–æ—Ä–æ—à–µ–º –∫–∞—á–µ—Å—Ç–≤–µ</title>
  <meta name="description" content="–°–º–æ—Ç—Ä–∏—Ç–µ —Ñ–∏–ª—å–º—ã –æ–Ω–ª–∞–π–Ω –±–µ—Å–ø–ª–∞—Ç–Ω–æ –Ω–∞ Genopoisk. –ë–æ–ª—å—à–æ–π –∫–∞—Ç–∞–ª–æ–≥ —Ñ–∏–ª—å–º–æ–≤ –≤ —Ö–æ—Ä–æ—à–µ–º –∫–∞—á–µ—Å—Ç–≤–µ: –Ω–æ–≤–∏–Ω–∫–∏, —Ç–æ–ø 250, –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ–∏–ª—å–º—ã –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã.">
  <meta name="keywords" content="—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∏–ª—å–º—ã –æ–Ω–ª–∞–π–Ω, —Ñ–∏–ª—å–º—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ, –∫–∏–Ω–æ –≤ —Ö–æ—Ä–æ—à–µ–º –∫–∞—á–µ—Å—Ç–≤–µ, –Ω–æ–≤–∏–Ω–∫–∏ –∫–∏–Ω–æ, —Ç–æ–ø —Ñ–∏–ª—å–º–æ–≤, –∫–∏–Ω–æ–ø–æ–∏—Å–∫, genopoisk, —Ç–æ–ø 250, —Å–º–æ—Ç—Ä–µ—Ç—å –∫–∏–Ω–æ –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã">
  <meta property="og:title" content="Genopoisk ‚Äî —Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∏–ª—å–º—ã –æ–Ω–ª–∞–π–Ω –±–µ—Å–ø–ª–∞—Ç–Ω–æ">
  <meta property="og:description" content="–ë–æ–ª—å—à–æ–π –∫–∞—Ç–∞–ª–æ–≥ —Ñ–∏–ª—å–º–æ–≤ –≤ —Ö–æ—Ä–æ—à–µ–º –∫–∞—á–µ—Å—Ç–≤–µ –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã">
  <meta property="og:image" content="https://genopoisk.vercel.app/icon-192.png">
  <meta property="og:url" content="https://genopoisk.vercel.app/">
  <meta property="og:type" content="website">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icon-192.png">
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
    
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    
    :root {
      --ios-blue: #007AFF;
      --ios-purple: #5856D6;
      --ios-pink: #FF2D55;
      --bg-color: #000000;
      --card-bg: #1C1C1E;
      --text-primary: #FFFFFF;
      --text-secondary: #8E8E93;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-primary);
      padding-bottom: 80px;
    }

    /* Header & Search */
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(20px);
      padding: 16px;
      border-bottom: 1px solid #333;
    }

    .logo {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 12px;
      background: linear-gradient(90deg, #FF9500, #FF2D55);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
    }

    .search-container {
      position: relative;
    }

    .search-input {
      width: 100%;
      background: #2C2C2E;
      border: none;
      border-radius: 12px;
      padding: 12px 16px 12px 40px;
      color: #fff;
      font-size: 16px;
      outline: none;
      transition: 0.2s;
    }

    .search-input:focus {
      background: #3A3A3C;
      box-shadow: 0 0 0 2px var(--ios-blue);
    }

    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      pointer-events: none;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 10px;
      padding: 12px 16px;
      overflow-x: auto;
      scrollbar-width: none;
    }
    .tabs::-webkit-scrollbar { display: none; }

    .tab {
      background: #2C2C2E;
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      white-space: nowrap;
      cursor: pointer;
      transition: 0.2s;
    }

    .tab.active {
      background: var(--ios-blue);
      color: #fff;
    }

    /* Grid */
    .container {
      padding: 16px;
    }

    .film-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 16px;
    }

    .card {
      background: transparent;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s;
      position: relative;
    }

    .card:active {
      transform: scale(0.96);
    }

    .poster-wrapper {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      aspect-ratio: 2/3;
      background: #2C2C2E;
    }

    .poster-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .film-rating {
      position: absolute;
      top: 6px;
      right: 6px;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
      color: #fff;
      padding: 2px 6px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .film-rating.high { border-color: #34C759; color: #34C759; }
    .film-rating.mid { border-color: #FF9500; color: #FF9500; }
    .film-rating.low { border-color: #FF3B30; color: #FF3B30; }

    .film-title {
      margin-top: 8px;
      font-size: 13px;
      font-weight: 500;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      height: 34px;
    }

    .film-year {
      font-size: 11px;
      color: var(--text-secondary);
      margin-top: 2px;
    }

    .loader {
      text-align: center;
      padding: 20px;
      color: var(--text-secondary);
    }
    
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: #fff;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 14px;
      opacity: 0;
      pointer-events: none;
      transition: 0.3s;
      z-index: 200;
    }
    .toast.show { opacity: 1; bottom: 30px; }
  </style>
</head>
<body>

  <header>
    <div class="logo">Genopoisk</div>
    <div class="search-container">
      <span class="search-icon">üîç</span>
      <input type="text" class="search-input" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤...">
    </div>
  </header>

  <div class="tabs">
    <button class="tab active" onclick="loadTop250()">–¢–æ–ø 250</button>
    <button class="tab" onclick="loadPopular()">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</button>
    <button class="tab" onclick="loadPremieres()">–ü—Ä–µ–º—å–µ—Ä—ã</button>
  </div>

  <div class="container">
    <div class="film-grid" id="filmGrid">
      <!-- –§–∏–ª—å–º—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
    </div>
    <div id="loader" class="loader">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    // === –ó–ê–©–ò–¢–ê –û–¢ –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø –ò F12 ===
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('copy', e => e.preventDefault());
    document.addEventListener('cut', e => e.preventDefault());
    document.addEventListener('selectstart', e => e.preventDefault());
    document.onkeydown = function(e) {
      const key = e.key || '';
      if (e.ctrlKey && (key === 'c' || key === 'C' || key === 'x' || key === 'X' || key === 'u' || key === 'U' || key === 's' || key === 'S')) {
        e.preventDefault(); return false;
      }
      if (key === 'F12') { e.preventDefault(); return false; }
    };

    // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ===
    const API_KEY = '3698ed63-120c-4285-8071-2811619a0a7c';
    const API_BASE = 'https://kinopoiskapiunofficial.tech/api';
    const SECRET_KEY = 'Genopoisk2026!x7K9pM2v'; // –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

    // === –°–ò–°–¢–ï–ú–ê –ó–ê–©–ò–©–Å–ù–ù–´–• –°–°–´–õ–û–ö ===
    function generateSecureLink(filmId, title) {
      // 1. –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ: ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
      const timestamp = Date.now();
      const rawData = `${filmId}|${title}|${timestamp}`;
      
      // 2. –ö–æ–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Base64
      const encodedData = btoa(rawData);
      
      // 3. –°–æ–∑–¥–∞–µ–º —Ö–µ—à (–ø–µ—Ä–≤—ã–µ 16 —Å–∏–º–≤–æ–ª–æ–≤ –æ—Ç Base64 —Å—Ç—Ä–æ–∫–∏ "–î–∞–Ω–Ω—ã–µ + –°–µ–∫—Ä–µ—Ç")
      const hashBase = btoa(rawData + SECRET_KEY);
      const hash = hashBase.slice(0, 16);
      
      // 4. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Å—ã–ª–∫—É
      return `player.html?p=${encodedData}&h=${hash}`;
    }

    function openPlayer(id, title) {
      const url = generateSecureLink(id, title);
      window.location.href = url;
    }

    // === API –§–£–ù–ö–¶–ò–ò ===
    const filmGrid = document.getElementById('filmGrid');
    const loader = document.getElementById('loader');

    async function apiGet(endpoint) {
      loader.style.display = 'block';
      try {
        const res = await fetch(`${API_BASE}${endpoint}`, {
          headers: { 'X-API-KEY': API_KEY, 'Content-Type': 'application/json' }
        });
        if (!res.ok) throw new Error('API Error');
        return await res.json();
      } catch (err) {
        showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
        console.error(err);
        return null;
      } finally {
        loader.style.display = 'none';
      }
    }

    function createCard(film) {
      const poster = film.posterUrlPreview || film.posterUrl || 'https://via.placeholder.com/150x225?text=No+Image';
      const rating = film.ratingKinopoisk || film.rating || '?';
      const year = film.year || film.startYear || '';
      const title = film.nameRu || film.nameEn || film.nameOriginal || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
      
      let ratingClass = 'low';
      if (rating >= 7) ratingClass = 'high';
      else if (rating >= 5) ratingClass = 'mid';

      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <div class="poster-wrapper">
          <img src="${poster}" loading="lazy" alt="${title}">
          <div class="film-rating ${ratingClass}">${rating}</div>
        </div>
        <div class="film-title">${title}</div>
        <div class="film-year">${year}</div>
      `;

      div.addEventListener('click', () => openPlayer(film.filmId || film.kinopoiskId, title));
      return div;
    }

    function displayFilms(films) {
      filmGrid.innerHTML = '';
      if (!films || films.length === 0) {
        filmGrid.innerHTML = '<div style="grid-column: 1/-1; text-align:center; padding: 20px; color: #666;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
        return;
      }
      films.forEach(film => {
        filmGrid.appendChild(createCard(film));
      });
    }

    // –ó–∞–≥—Ä—É–∑—á–∏–∫–∏
    async function loadTop250() {
      const data = await apiGet('/v2.2/films/top?type=TOP_250_BEST_FILMS&page=1');
      displayFilms(data?.films);
      updateActiveTab(0);
    }

    async function loadPopular() {
      const data = await apiGet('/v2.2/films/collections?type=POPULAR_SERIES&page=1'); // –ò–ª–∏ TOP_POPULAR_FILMS
      // –ü–æ–ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ–∏–ª—å–º—ã, –µ—Å–ª–∏ SERIES –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–∞–º–µ–Ω–∏–º –Ω–∞ TOP_POPULAR_ALL
      const dataFilms = await apiGet('/v2.2/films/collections?type=TOP_POPULAR_ALL&page=1');
      displayFilms(dataFilms?.items || data?.films);
      updateActiveTab(1);
    }

    async function loadPremieres() {
      const year = new Date().getFullYear();
      const month = String(new Date().getMonth() + 1).padStart(2, '0');
      const data = await apiGet(`/v2.2/films/premieres?year=${year}&month=${month}`);
      displayFilms(data?.items);
      updateActiveTab(2);
    }

    function updateActiveTab(index) {
      document.querySelectorAll('.tab').forEach((t, i) => {
        t.classList.toggle('active', i === index);
      });
    }

    // –ü–æ–∏—Å–∫
    let searchTimeout;
    document.getElementById('searchInput').addEventListener('input', (e) => {
      clearTimeout(searchTimeout);
      const query = e.target.value.trim();
      if (query.length < 3) return;
      
      searchTimeout = setTimeout(async () => {
        const data = await apiGet(`/v2.1/films/search-by-keyword?keyword=${encodeURIComponent(query)}&page=1`);
        displayFilms(data?.films);
      }, 500);
    });

    // –¢–æ—Å—Ç—ã
    function showToast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 3000);
    }

    // –°—Ç–∞—Ä—Ç
    loadTop250();

    // Telegram WebApp
    window.Telegram?.WebApp?.expand?.();
    window.Telegram?.WebApp?.setHeaderColor?.("#000000");
  </script>
</body>
</html>
